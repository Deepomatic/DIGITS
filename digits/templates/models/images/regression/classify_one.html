{# Copyright (c) 2014-2015, NVIDIA CORPORATION.  All rights reserved. #}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.5.0/fabric.js"></script>

<!--         <img src="{{image_src}}" style="width:{{image_width}}px;height:{{image_height}}px;" />
 -->  
<div class="row">
    <div class="col-sm-6">
    <canvas id="c" width="600" height="250" class="lower-canvas" >
  </canvas>
    <script type="text/javascript">
    (function() {
        var canvas = this.__canvas = new fabric.StaticCanvas('c');

        {% for b in predictions["boxes"] %}
            canvas.bringToFront(new fabric.Rect({{b|tojson|safe}}));
        {% endfor %}
        // var box = new fabric.Rect({'borderColor': 'rgba(255,0,0)', 'top': 97.530133622828174, 'height': 201.91876173739027, 'width': 227.0, 'left': 54.138485535581779, 'fill': 'rgba(255,0,0,0.2)'});
        //canvas.bringToFront(box);

      fabric.Image.fromURL("{{raw_img}}", function(img) {
        canvas.sendToBack(img);
      });
  })();

    </script>
    </div>
        <table class="table table-bordered">
            <thead>
                <td></td>
                {% for labels in predictions["labels"] %}
                <td> {{ labelsÂ }} </td>
                {% endfor %}

            </thead>
            <tbody>
                {% for key, labels in predictions["predictions"].iteritems() %}
                    <tr>
                        <td> {{key}} </td>
                        {% for label in labels %}
                        <td> {{label[1]}} </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

</div>
<div class="row" id="chart">

</div>
    
</div>
<script type="text/javascript">
var chart = c3.generate({
    bindto: '#chart',
    data: {{predictions["data"]|tojson|safe}},
    axis: {
        x: {
            center: 1,
            type: 'category' // this needed to load string x value
        }
    }
});
</script>

<script type="text/javascript">
    function drawHistogram(id, data) {
        c3.generate({
            bindto: id,
            size: {height: 200},
            data: {
                columns: [
                    ['Count'].concat(data[0]),
                    ['Value'].concat(data[1]),
                ],
                x: 'Value',
                type: 'area-spline',
            },
            axis: {
                x: {
                    label: {
                        text: 'Value',
                        position: 'outer-center',
                    },
                    tick: {
                        values: data[2],
                        format: d3.format('.3g'),
                    },
                    padding: {left: 0},
                },
                y: {
                    padding: {bottom: 0},
                },
            },
            bar: {
               width: {ratio: 0.2}
            },
            padding: {left: 20, right: 20},
            legend: {hide: true},
        });
    }
</script>
<style>
    div.histogram .c3-axis-y .tick {
        display: none;
    }
</style>

{% if visualizations %}
<table class="table">
    <tr>
        <th>Description</th>
        <th width="20%">Statistics</th>
        <th>Visualization</th>
    </tr>
    {% for vis in visualizations %}
    <tr>
        <td>
            <h4>{{vis['name']}}</h4>
            {{vis['type']}}
        </td>
        <td>
            <b>Mean:</b> {{vis['mean']}}<br>
            <b>Std deviation:</b> {{vis['stddev']}}<br>
            <div id="histogram-{{loop.index}}" class="histogram"></div>
            <script>
                drawHistogram("#histogram-{{loop.index}}", {{vis['histogram']}});
            </script>
        </td>
        <td>
            {% if vis['image_html'] %}
            <img style="max-width:100%" src="{{vis['image_html']}}" />
            {% else %}
            <i>Not shown</i>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}

