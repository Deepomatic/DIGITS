{# Copyright (c) 2014-2015, Deepomatic SAS.  All rights reserved. #}

{% extends "job.html" %}


{% macro print_job_information() %}
<div class="panel-heading">
    <h4>Job Information</h4>
</div>
<div class="panel-body">
    <dl>
        <dt>Job Directory</dt>
        <dd>{{ job.dir() }}</dd>
    </dl>
</div>
{% endmacro %}

{% macro print_parse_folder_task(task) %}
<div class="panel-heading">
    <h4>{{task.name()}}</h4>
</div>
<div class="panel-body">
    <dl>
        <dt>Folder</dt>
        <dd>{{task.folder}}</dd>
    </dl>
 </div>
{% endmacro %}
 
{% block job_content %} 

<script>
function drawConfusionMatrix(data) {
    $(".confusion-matrix").show();

    $('.confusion-matrix').empty();
    $('.confusion-matrix').append(data["results"]);
}

function drawAverageAccuracyGraph(data) {
    $(".avgacc-graph").show();

    c3.generate({
        "bindto": '.avgacc-graph',
        "data": data, 
        "axis": {
            "x": {
                "show": true,
                "tick": {
                    format: function (x) { return  x.toFixed(2); }
                },
                "label": {
                    "text": "Confidence threshold",
                    "position": "outer-left"
                }

            },
            "y": {
                "show": true,
                "label": { 
                  "text": 'Accuracy (%)',
                  "position": 'outer-middle'
                },
                "tick": {
                    format: function (x) { return  100*x.toFixed(2); }
                },

            },
            "y2": {
                "show": true,
                "label": { 
                  "text": 'Percentage of answer (%)',
                  "position": 'outer-middle'
                },
                "tick": {
                    format: function (x) { return  100*x.toFixed(2); }
                },
            }
        }
     });
 
}

</script>
 

<h2>Average accuracy</h2>

<div class="avgacc-graph" style="height:300px;width:100%;background:white;display:none;"></div>
<h2>Confusion matrix</h2>


<pre class="confusion-matrix" style="display:none;"></pre>
{% set avg_accuracy_graph_data = job.accuracy_task().avg_accuracy_graph_data() %}
{% set confusion_matrix_data = job.accuracy_task().confusion_matrix_data() %}
{% if avg_accuracy_graph_data %}
<script>
    drawAverageAccuracyGraph({% autoescape false %}{{avg_accuracy_graph_data}}{% endautoescape %});
</script>
{% endif %}




{% if confusion_matrix_data %}
<script>
    drawConfusionMatrix({% autoescape false %}{{confusion_matrix_data}}{% endautoescape %});
</script>
{% endif %}



{% endblock %}

